<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bet with Thuto - Pro Edition</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 20px;
            background: 
                linear-gradient(rgba(0, 80, 0, 0.85), rgba(0, 40, 0, 0.9)),
                url('https://images.unsplash.com/photo-1511880759946-74e50f6e4b6f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') center/cover no-repeat,
                url('https://images.unsplash.com/photo-1593341646782-e0b495cff86d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') center/cover;
            background-blend-mode: overlay;
            color: #fff; min-height: 100vh;
            position: relative;
        }
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://i.imgur.com/8z3i1aP.png') repeat;
            opacity: 0.15; pointer-events: none; z-index: 0;
        }
        .container { 
            max-width: 1200px; margin: 0 auto; background: rgba(255,255,255,0.95); 
            border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.3); 
            overflow: hidden; position: relative; z-index: 1; color: #333;
        }
        header { 
            background: linear-gradient(135deg, #1B5E20, #2E7D32); color: white; 
            padding: 25px; text-align: center; 
        }
        h1 { margin: 0; font-size: 2.8em; text-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .intro { padding: 20px; text-align: center; background: #f0f7f0; }
        .controls { padding: 25px; text-align: center; background: #e8f5e8; }
        button {
            background: linear-gradient(135deg, #2E7D32, #4CAF50); color: white; 
            padding: 14px 32px; font-size: 16px; margin: 8px; cursor: pointer; 
            border: none; border-radius: 30px; transition: all 0.3s; font-weight: bold;
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(76,175,80,0.5); }
        button:disabled { background: #aaa; cursor: not-allowed; }
        input[type="date"], input[type="number"] { 
            padding: 12px; width: 280px; border: 1px solid #4CAF50; border-radius: 8px; 
            margin: 10px; font-size: 16px;
        }
        #dateQuick { 
            background: #1B5E20; padding: 10px 18px; font-size: 14px; 
            border-radius: 25px; margin: 5px;
        }
        #slip { padding: 25px; }
        .suggestion {
            margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #f8fff8, #e8f5e8);
            border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); transition: transform 0.3s;
        }
        .suggestion:hover { transform: scale(1.02); }
        .suggestion summary { 
            font-size: 1.4em; color: #1B5E20; cursor: pointer; padding: 12px; 
            background: white; border-radius: 10px; margin-bottom: 15px; font-weight: bold;
        }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 3px 12px rgba(0,0,0,0.1); }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #1B5E20; color: white; font-weight: bold; }
        .summary {
            background: linear-gradient(135deg, #e8f5e8, #d0e8d0); padding: 15px; border-radius: 10px;
            margin: 15px 0; font-weight: bold; border-left: 6px solid #4CAF50;
        }
        .risk-meter { width: 100%; height: 18px; background: #ddd; border-radius: 9px; overflow: hidden; margin: 8px 0; }
        .risk-fill { height: 100%; transition: width 0.6s; }
        .low { background: #4CAF50; }
        .medium { background: #FF9800; }
        .high { background: #f44336; }
        .league { font-style: italic; color: #1B5E20; font-weight: bold; }
        .value-high { background: #e8f5e8 !important; }
        .consensus { background: #fff8e1; padding: 4px 8px; border-radius: 5px; font-weight: bold; }
        .export-btn { background: linear-gradient(135deg, #1565C0, #1976D2); }
        .verify-btn { background: linear-gradient(135deg, #FF6D00, #FF8A65); }
        .disclaimer { padding: 25px; text-align: center; background: #fff3e0; color: #e65100; border-radius: 12px; margin: 25px; font-weight: bold; }
        #loading { text-align: center; color: #1B5E20; font-style: italic; padding: 30px; font-size: 1.1em; }
        #error { text-align: center; color: #c62828; background: #ffebee; padding: 15px; border-radius: 10px; margin: 15px; font-weight: bold; }
        .strategy { font-size: 0.9em; color: #1B5E20; margin-bottom: 8px; font-weight: bold; }
        .real-fixture { background: #c8e6c9 !important; font-weight: bold; }
        .calendar-note { font-size: 0.95em; color: #1B5E20; text-align: center; margin: 15px 0; font-style: italic; }
        .pro-tips { background: #e8f5e8; padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 5px solid #4CAF50; }
        .history-section { margin-top: 25px; padding: 20px; background: #f5f5f5; border-radius: 12px; }
        .history-item { padding: 12px; margin: 8px 0; background: white; border-radius: 8px; border-left: 5px solid #4CAF50; }
        .alert-btn { background: linear-gradient(135deg, #FF6D00, #FF8A65); margin-left: 12px; }
        .expert-section { margin: 25px 0; padding: 20px; background: #e3f2fd; border-radius: 12px; }
        .expert { display: inline-block; margin: 6px; padding: 10px 16px; background: white; border-radius: 25px; cursor: pointer; font-weight: bold; }
        .expert:hover { background: #4CAF50; color: white; }
    </style>
</head>
<body>
    <div class="overlay"></div>
    <div class="container">
        <header>
            <h1>Bet with Thuto - Pro Edition</h1>
            <p>AI-Powered | Real Fixtures | +EV Picks | Kelly Stakes | 1500+ Pula Target</p>
        </header>
        <div class="intro">
            <p>Powered by <strong>Football-Data.org</strong> via your <strong>live API</strong>. Only real fixtures for your selected date. CAT time. High-EV legs only.</p>
        </div>
        <div class="controls">
            <div>
                <label for="bankrollInput">Bankroll (Pula):</label><br>
                <input type="number" id="bankrollInput" value="1000" min="1">
            </div>
            <div>
                <label for="datePicker">Select Date:</label><br>
                <input type="date" id="datePicker">
                <br>
                <button id="dateQuick" onclick="setToday()">Today</button>
                <button id="dateQuick" onclick="setTomorrow()">Tomorrow</button>
                <button id="dateQuick" onclick="setWeekend()">Weekend</button>
            </div>
            <br>
            <button id="generateBtn" onclick="generateSlips()">Generate Pro Suggestions</button>
            <button class="alert-btn" onclick="toggleAlerts()">Toggle Alerts</button>
            <button class="export-btn" onclick="exportSlips()" id="exportBtn" style="display:none;">Export Slips</button>
            <button class="verify-btn" onclick="verifyFixtures()">Verify on Flashscore</button>
            <div class="calendar-note">Pick any date → Only real fixtures for that day (e.g. Oct 5 = Lyon vs Nantes, Nice vs PSG)</div>
        </div>

        <div class="pro-tips">
            <h3>Pro Tips</h3>
            <ul>
                <li><strong>+EV > 5%</strong>: Only high-value legs included</li>
                <li><strong>Kelly Stakes</strong>: Optimal bankroll use (25–40% Kelly)</li>
                <li><strong>Real Fixtures</strong>: Green rows = confirmed matches</li>
                <li><strong>CAT Time</strong>: All times in Botswana (UTC+2)</li>
            </ul>
        </div>

        <div id="loading">Fetching real fixtures for your date...</div>
        <div id="error"></div>
        <div id="slip"></div>

        <div class="history-section" id="historySection" style="display:none;">
            <h3>Bet History</h3>
            <button onclick="clearHistory()">Clear</button>
            <div id="historyList"></div>
        </div>

        <div class="disclaimer">
            <strong>Win Smarter:</strong> Real data. Verified fixtures. +EV picks. Kelly stakes. Gamble responsibly.
        </div>
    </div>

    <script>
        // === CONFIG ===
        const API_URL = 'https://thuto-betting-tips-api.ttbaoleki.replit.co';
        let state = {
            selectedDate: '',
            bankroll: 1000,
            alertsEnabled: false,
            TARGET_ODDS: 1500
        };

        // === UTILS ===
        function setToday() { setDateOffset(0); }
        function setTomorrow() { setDateOffset(1); }
        function setWeekend() {
            const d = new Date(); const day = d.getDay();
            const diff = day === 0 ? 6 : 5 - day;
            setDateOffset(diff + 1);
        }
        function setDateOffset(days) {
            const d = new Date(); d.setDate(d.getDate() + days);
            state.selectedDate = d.toISOString().split('T')[0];
            document.getElementById('datePicker').value = state.selectedDate;
        }

        function showError(msg) {
            document.getElementById('error').innerHTML = `<p>${msg}</p>`;
            document.getElementById('loading').style.display = 'none';
        }

        function verifyFixtures() {
            const d = state.selectedDate.replace(/-/g, '/');
            window.open(`https://www.flashscore.com/football/${d}/`, '_blank');
        }

        function toggleAlerts() {
            state.alertsEnabled = !state.alertsEnabled;
            const btn = document.querySelector('.alert-btn');
            btn.textContent = state.alertsEnabled ? 'Alerts ON' : 'Toggle Alerts';
            if (state.alertsEnabled) Notification.requestPermission();
        }

        // === API CALLS ===
        async function fetchFixtures() {
            const date = state.selectedDate;
            if (!date) { showError('Select a date first.'); return []; }
            try {
                const res = await fetch(`${API_URL}/fixtures?date=${date}`);
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Failed');
                return data.fixtures || [];
            } catch (e) {
                showError(`API Error: ${e.message}. Using demo data.`);
                return getDemoFixtures(date);
            }
        }

        async function fetchSuggestions() {
            const date = state.selectedDate;
            const bankroll = document.getElementById('bankrollInput').value || 1000;
            state.bankroll = parseFloat(bankroll);
            try {
                const res = await fetch(`${API_URL}/suggestions?date=${date}&bankroll=${state.bankroll}&strategy=balanced`);
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Failed');
                return data;
            } catch (e) {
                showError(`Suggestions failed: ${e.message}`);
                return null;
            }
        }

        // === RENDER ===
        async function generateSlips() {
            const btn = document.getElementById('generateBtn');
            const date = document.getElementById('datePicker').value;
            if (!date) { showError('Pick a date!'); return; }
            state.selectedDate = date;

            btn.disabled = true; btn.textContent = 'Analyzing...';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').innerHTML = '';
            document.getElementById('exportBtn').style.display = 'none';

            const suggestions = await fetchSuggestions();
            if (!suggestions || !suggestions.slips) {
                btn.disabled = false; btn.textContent = 'Generate Pro Suggestions';
                document.getElementById('loading').style.display = 'none';
                return;
            }

            let html = `<p><em>Pro Scan: ${suggestions.slips.length} high-EV legs for ${date}</em></p>`;
            html += `<details class="suggestion open">
                <summary>${suggestions.strategy} (EV: ${suggestions.totalEV})</summary>
                <div class="slip-details">
                    <p class="strategy">Target: 1500x | Bankroll: ${state.bankroll} Pula</p>
                    <table><thead><tr>
                        <th>Leg</th><th>League</th><th>Match</th><th>CAT Time</th>
                        <th>Pick</th><th>Odds</th><th>EV</th><th>Stake</th>
                    </tr></thead><tbody>`;

            suggestions.slips.forEach(s => {
                const rowClass = (parseFloat(s.ev) > 5 ? 'value-high' : '') + (s.isReal ? ' real-fixture' : '');
                html += `<tr class="${rowClass}">
                    <td>${s.leg}</td>
                    <td class="league">${s.league}</td>
                    <td>${s.match}</td>
                    <td>${s.catTime}</td>
                    <td><strong>${s.selection}</strong></td>
                    <td>${s.odds}</td>
                    <td>${s.ev}%</td>
                    <td>${s.kellyStake}</td>
                </tr>`;
            });

            html += `</tbody></table>`;
            const profit = (suggestions.totalOdds * 1 - 1).toFixed(0);
            html += `<div class="summary">
                <p><strong>Odds:</strong> ${suggestions.totalOdds}x | 
                   <strong>Return:</strong> ${profit} Pula | 
                   <strong>Win Prob:</strong> ${suggestions.totalProb}</p>
                <p><strong>Total EV:</strong> ${suggestions.totalEV} | 
                   <strong>Kelly Stake:</strong> Use per leg</p>
                <div class="risk-meter"><div class="risk-fill medium" style="width: 65%"></div></div>
            </div></div></details>`;

            document.getElementById('slip').innerHTML = html;
            document.getElementById('exportBtn').style.display = 'inline-block';
            saveToHistory(suggestions);
            if (state.alertsEnabled && parseFloat(suggestions.totalEV) > 2) {
                new Notification('High EV Slip!', { body: `${suggestions.strategy}: ${suggestions.totalEV} EV` });
            }

            btn.disabled = false; btn.textContent = 'Generate Pro Suggestions';
            document.getElementById('loading').style.display = 'none';
        }

        function exportSlips() {
            const data = document.querySelector('#slip table')?.innerText || 'No data';
            navigator.clipboard.writeText(data).then(() => alert('Exported to clipboard!'));
        }

        function saveToHistory(data) {
            let h = JSON.parse(localStorage.getItem('thutoHistory') || '[]');
            h.unshift({ date: state.selectedDate, data, time: new Date().toLocaleString() });
            if (h.length > 10) h.pop();
            localStorage.setItem('thutoHistory', JSON.stringify(h));
            updateHistory();
        }

        function updateHistory() {
            const h = JSON.parse(localStorage.getItem('thutoHistory') || '[]');
            let list = '';
            h.forEach((e, i) => {
                list += `<div class="history-item">
                    <strong>${e.date}</strong>: ${e.data.slips.length} legs
                    <button onclick="loadSlip(${i})">Load</button>
                </div>`;
            });
            document.getElementById('historyList').innerHTML = list;
            document.getElementById('historySection').style.display = h.length ? 'block' : 'none';
        }

        function clearHistory() {
            localStorage.removeItem('thutoHistory');
            updateHistory();
        }

        window.loadSlip = (i) => {
            const h = JSON.parse(localStorage.getItem('thutoHistory') || '[]');
            const d = h[i].data;
            state.selectedDate = h[i].date;
            document.getElementById('datePicker').value = state.selectedDate;
            // Re-render logic simplified
            alert('Slip loaded! Click Generate to view.');
        };

        // === INIT ===
        window.addEventListener('load', () => {
            setToday();
            updateHistory();
            Notification.requestPermission();
        });
    </script>
</body>
</html>
