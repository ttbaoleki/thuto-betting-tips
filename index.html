<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thuto's Daily Betting Tips</title>

  <!-- React 18 UMD + client -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.client.development.js" crossorigin></script>

  <!-- Babel for in-browser JSX (ok for demo / GitHub Pages) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Custom theme (FirstCred-like: dark blue, orange, white) */
    :root{
      --brand-blue: #0B3D91; /* deep blue */
      --brand-orange: #FF7A00;
      --muted: #6B7280;
    }
    .brand-blue { background-color: var(--brand-blue); color: white; }
    .brand-blue-text { color: var(--brand-blue); }
    .brand-orange { background-color: var(--brand-orange); color: white; }
    .card { box-shadow: 0 6px 18px rgba(8,20,50,0.06); border-radius: 12px; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

  <div id="root" class="p-4"></div>

  <script type="text/babel">
  // -------- CONFIG ----------
  const API_PROVIDER = 'the-odds-api'; // placeholder
  const API_KEY = 'YOUR_API_KEY_HERE'; // <-- replace with your key for live odds
  const TARGET_ODDS_MAX = 1.25; // default target (we'll give you UI to adjust)

  // Fallback mock data (safe)
  const MOCK_SUGGESTIONS = [
    { id: 1, match: "Arsenal vs Chelsea", league: "Premier League", date: "2025-09-28", time: "15:00", market: "Double Chance (1X)", odds: 1.22, confidence: "High", reasoning: "Home xG advantage", betwayLink: "https://www.betway.com" },
    { id: 2, match: "Bayern vs Dortmund", league: "Bundesliga", date: "2025-09-28", time: "18:30", market: "Over 2.5 Goals", odds: 1.19, confidence: "Medium-High", reasoning: "High scoring fixture", betwayLink: "https://www.betway.com" },
    { id: 3, match: "Real Madrid vs Valencia", league: "La Liga", date: "2025-09-28", time: "20:00", market: "Home Win", odds: 1.18, confidence: "High", reasoning: "Real strong at home", betwayLink: "https://www.betway.com" },
    // more mock entries...
  ];

  // ---------- UTIL ----------
  function formatOdds(o){ return Number(o).toFixed(2); }

  // ------------ API (fetch odds) ------------
  async function fetchOddsFromTheOddsApi(region='uk', sportKey='soccer_epl') {
    // The Odds API uses endpoints like /v4/sports/{sportKey}/odds
    // We'll fetch some odds and then map them to our UI format.
    if(!API_KEY || API_KEY === 'YOUR_API_KEY_HERE') throw new Error('No API key provided');

    const url = `https://api.the-odds-api.com/v4/sports/${sportKey}/odds/?regions=${region}&oddsFormat=decimal&markets=h2h,totals&dateFormat=iso&apiKey=${API_KEY}`;
    const r = await fetch(url);
    if(!r.ok) throw new Error('Odds API error: ' + r.status);
    const data = await r.json();
    // Map to suggestion-like objects (pick cheapest available market that matches our target odds)
    const suggestions = [];
    for(const ev of data){
      // ev.bookmakers[] -> find best bookmaker with smallest favourite odds near target
      const evMarkets = ev.bookmakers && ev.bookmakers.length ? ev.bookmakers.flatMap(b => b.markets.map(m => ({book: b.key, m}))): [];
      // Pick first h2h or totals market for display
      const m = evMarkets.find(x => x.m.key === 'h2h' || x.m.key==='totals')?.m;
      if(!m) continue;
      // find an outcome with odds near target (<= TARGET_ODDS_MAX)
      const outcome = m.outcomes?.find(o => o.price && o.price <= TARGET_ODDS_MAX);
      // fallback: pick smallest price outcome
      const bestOutcome = outcome ?? (m.outcomes && m.outcomes.reduce((a,b)=> a.price < b.price ? a : b, m.outcomes[0]));
      if(!bestOutcome) continue;
      suggestions.push({
        id: ev.id || ev.home_team + ev.away_team,
        match: `${ev.home_team} vs ${ev.away_team}`,
        league: ev.competition?.name || ev.league || 'Unknown',
        date: ev.commence_time?.split('T')[0] || ev.start_time?.split('T')[0] || '',
        time: ev.commence_time?.split('T')[1]?.slice(0,5) || '',
        market: bestOutcome.name || (m.key==='h2h'? 'Match Winner': m.key),
        odds: bestOutcome.price || 1.0,
        confidence: 'Auto',
        reasoning: `Odds from ${ev.bookmakers && ev.bookmakers[0] ? ev.bookmakers[0].title : 'bookmaker'}`,
        betwayLink: 'https://www.betway.com'
      });
    }
    return suggestions;
  }

  // -------- React App ----------
  function App(){
    const [suggestions, setSuggestions] = React.useState(MOCK_SUGGESTIONS);
    const [loading, setLoading] = React.useState(false);
    const [error, setError] = React.useState(null);

    const [query, setQuery] = React.useState('');
    const [leagueFilter, setLeagueFilter] = React.useState('All');
    const [maxOdds, setMaxOdds] = React.useState(TARGET_ODDS_MAX);
    const [selectedMarket, setSelectedMarket] = React.useState('Any');

    const leagues = React.useMemo(()=> {
      const s = new Set(suggestions.map(s=>s.league));
      return ['All', ...Array.from(s)];
    }, [suggestions]);

    // fetch live odds - tries The Odds API (sportKey e.g. 'soccer_epl' for Premier League)
    async function refresh(sportKey='soccer_epl'){
      setLoading(true); setError(null);
      try {
        const live = await fetchOddsFromTheOddsApi('uk', sportKey);
        if(live && live.length>0) {
          setSuggestions(live);
        } else {
          // fallback to mock if empty
          setSuggestions(MOCK_SUGGESTIONS);
        }
      } catch (err){
        console.warn('Live fetch failed', err);
        setError(err.message);
        setSuggestions(MOCK_SUGGESTIONS);
      } finally {
        setLoading(false);
      }
    }

    React.useEffect(()=> {
      // auto-refresh once when app mounts (try live)
      refresh().catch(()=>{});
    }, []);

    // Filters
    const filtered = suggestions.filter(s => {
      if(leagueFilter!=='All' && s.league !== leagueFilter) return false;
      if(selectedMarket!=='Any' && !s.market.toLowerCase().includes(selectedMarket.toLowerCase())) return false;
      if(query && !(`${s.match} ${s.league}`).toLowerCase().includes(query.toLowerCase())) return false;
      if(maxOdds && Number(s.odds) > Number(maxOdds)) return false;
      return true;
    });

    // derive some simple reports/stats
    const stats = React.useMemo(()=> {
      const total = suggestions.length;
      const avgOdds = suggestions.reduce((a,b)=> a + Number(b.odds || 0), 0) / Math.max(total,1);
      const profitable = suggestions.filter(s=> Number(s.odds) <= 1.2).length;
      return { total, avgOdds: avgOdds.toFixed(2), profitable };
    }, [suggestions]);

    return (
      <div className="max-w-6xl mx-auto">
        <header className="brand-blue p-4 rounded-lg card">
          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-2xl font-bold">Thuto's Daily Betting Tips</h1>
              <p className="text-sm opacity-90">Data-driven tips — filter to find odds near ~1.20</p>
            </div>
            <div className="text-right">
              <button className="brand-orange px-3 py-2 rounded font-semibold" onClick={()=>refresh()}>
                Refresh Live Odds
              </button>
              <div className="text-xs mt-1 text-white/80">Provider: {API_PROVIDER}</div>
            </div>
          </div>
        </header>

        <main className="grid grid-cols-1 lg:grid-cols-3 gap-4 mt-4">
          {/* Left: Controls + Suggestions */}
          <section className="lg:col-span-2 space-y-4">
            <div className="card p-4 bg-white">
              <div className="flex gap-2 flex-col md:flex-row md:items-center">
                <input placeholder="Search match or team..." className="flex-1 border p-2 rounded" value={query} onChange={(e)=>setQuery(e.target.value)} />
                <select className="border p-2 rounded" value={leagueFilter} onChange={(e)=>setLeagueFilter(e.target.value)}>
                  {leagues.map(l=> <option key={l} value={l}>{l}</option>)}
                </select>
                <select className="border p-2 rounded" value={selectedMarket} onChange={(e)=>setSelectedMarket(e.target.value)}>
                  <option>Any</option>
                  <option>h2h</option>
                  <option>totals</option>
                  <option>Double Chance</option>
                  <option>Over/Under</option>
                </select>
                <div className="flex items-center gap-2">
                  <label className="text-sm">Max Odds</label>
                  <input type="range" min="1.01" max="2.50" step="0.01" value={maxOdds} onChange={(e)=>setMaxOdds(e.target.value)} />
                  <div className="w-16 text-right">{Number(maxOdds).toFixed(2)}</div>
                </div>
              </div>
            </div>

            <div className="space-y-3">
              {loading && <div className="p-4 card bg-white">Loading live odds...</div>}
              {error && <div className="p-3 card bg-red-50 text-red-700">Error loading live odds: {error}</div>}

              {filtered.length === 0 && <div className="p-4 card bg-white">No suggestions match your filters.</div>}

              {filtered.map(s => (
                <div key={s.id} className="p-4 card bg-white flex justify-between items-start">
                  <div>
                    <div className="flex items-baseline gap-2">
                      <h3 className="text-lg font-semibold">{s.match}</h3>
                      <span className="text-sm text-muted">{s.league}</span>
                    </div>
                    <div className="text-sm text-gray-600">{s.date} {s.time} • {s.market}</div>
                    <p className="mt-2">{s.reasoning}</p>
                  </div>
                  <div className="text-right">
                    <div className="text-xl font-bold brand-blue-text">{formatOdds(s.odds)}</div>
                    <a className="inline-block mt-2 brand-orange px-3 py-1 rounded text-sm" href={s.betwayLink || '#'} target="_blank">Bet on Betway</a>
                  </div>
                </div>
              ))}
            </div>
          </section>

          {/* Right: Reports & Quick Stats */}
          <aside className="space-y-4">
            <div className="card p-4 bg-white">
              <h4 className="font-semibold">Quick Stats</h4>
              <p className="mt-2 text-sm text-gray-700">Total suggestions: <strong>{stats.total}</strong></p>
              <p className="text-sm text-gray-700">Avg odds: <strong>{stats.avgOdds}</strong></p>
              <p className="text-sm text-gray-700">Odds ≤ 1.20: <strong>{stats.profitable}</strong></p>
            </div>

            <div className="card p-4 bg-white">
              <h4 className="font-semibold">Performance (mock)</h4>
              <table className="w-full text-sm mt-2">
                <thead>
                  <tr><th className="text-left">Date</th><th>W</th><th>L</th><th>Profit</th></tr>
                </thead>
                <tbody>
                  <tr><td>2025-09-26</td><td className="text-center">2</td><td className="text-center">0</td><td className="text-center">+0.42</td></tr>
                  <tr><td>2025-09-25</td><td className="text-center">1</td><td className="text-center">1</td><td className="text-center">-0.01</td></tr>
                </tbody>
              </table>
            </div>

            <div className="card p-4 bg-white">
              <h4 className="font-semibold">Share</h4>
              <p className="text-sm text-gray-600">Copy this page URL and share with followers.</p>
              <button className="mt-2 border rounded px-3 py-1" onClick={()=>navigator.clipboard?.writeText(window.location.href)}>Copy Link</button>
            </div>
          </aside>
        </main>

        <footer className="text-center text-sm text-gray-500 mt-6 mb-6">
          <div>Data provider: {API_PROVIDER} (live fetch requires API key). If live is not available we use mock data.</div>
          <div className="mt-2">Powered by Thuto — use responsibly. Betting involves risk.</div>
        </footer>
      </div>
    );
  }

  // Render
  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(<App />);
  </script>
</body>
</html>
